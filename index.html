<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Chess</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
</head>
<body>

    <canvas id="myCanvas" width="768" height="768"></canvas>

<script>
    
// ---------Board Representation
var boardSquares = [];
for (var i=0;i<=64;i++) {
boardSquares[i]=0;
        var squareX=(i % 8);
        var squareY = Math.floor(i/8);
        if((squareY==6)){
            boardSquares[i]=1;
       }
       if((squareY==1)){
            boardSquares[i]=7;
       }
       switch(i) {
    case 0:case 7:
    boardSquares[i]=10;break;
    case 1:case 6:
    boardSquares[i]=9;break;
    case 2:case 5:
    boardSquares[i]=8;break;

    case 63:case 56:
    boardSquares[i]=4;break;
    case 62:case 57:
    boardSquares[i]=3;break;
    case 61:case 58:
    boardSquares[i]=2;break;
    
    case 59:
    boardSquares[i]=5;break;
    case 60:
    boardSquares[i]=6;break;
    case 3:
    boardSquares[i]=11;break;
    case 4:
    boardSquares[i]=12;break;
    
       }
    }


	const canvas = document.getElementById("myCanvas");
    const ctx = canvas.getContext("2d");
    
    var boardResolution = canvas.width;


    var pieces = new Array();
    for (let i = 1; i <= 12; i++) {
        pieces[i] = new Image();
    pieces[i].src = 'resources/'+i+'.png';
    }
    pieces[13] = new Image();
    pieces[14] = new Image();
    pieces[15] = new Image();
    pieces[16] = new Image();
    
    pieces[13].src = 'resources/legalMoveDot.png';
    pieces[14].src = 'resources/redDot.png';
    pieces[15].src = 'resources/sword.png';
    pieces[16].src = 'resources/sword_b.png';

    pieces[12].onload = function(){renderStills();}

   // ctx.drawImage(pieces[1],0, 0, boardResolution/8, boardResolution/8);



    

//function draw() {
//    ctx.drawImage(pieces[1],0, 0, boardResolution/8, boardResolution/8);
//}
//setInterval(draw, 1000);
var relativeX = 0;
var relativeY = 0;
var mousedownBool = false;
function renderStills(){
    for(var i=0;i<=64-1;i++){
            var squareX=(i % 8);
            var squareY = Math.floor(i/8);
            if((boardSquares[i]!=0)&& draggedPiece !=i){
                ctx.drawImage(pieces[boardSquares[i]],squareX*boardResolution/8, squareY*boardResolution/8, boardResolution/8, boardResolution/8);
            }}

}
function updateCursorIcon(){
    var selectionX = Math.ceil(relativeX/boardResolution*8)-1;
     var selectionY = Math.ceil(relativeY/boardResolution*8)-1;
     var selection = (((selectionY*8)-1)+selectionX)+1;
     if(mousedownBool && draggedPiece>0){
        document.body.style.cursor = 'grabbing';
     }
     else if (boardSquares[selection]>0){
        document.body.style.cursor = 'grab';
     }else{
        document.body.style.cursor = 'default';
     }
}

document.addEventListener("mousemove", mouseMoveHandler, false);
document.addEventListener("mousedown", mouseDownHandler, false);
document.addEventListener("mouseup", mouseUpHandler, false);

function mouseMoveHandler(e) {
     relativeX = e.clientX - canvas.offsetLeft;
     relativeY = e.clientY - canvas.offsetTop;
updateCursorIcon();
    if(mousedownBool&&mouseOnBoard(e)){

        drawBackground();

//Draws legal move dots
updateLegalMoves();
        for(var i=0;i<=legalMovesToShow.length;i++){
            
            var squareX=(legalMovesToShow[i] % 8);
            var squareY = Math.floor(legalMovesToShow[i]/8);
          ctx.drawImage(pieces[13],squareX*boardResolution/8, squareY*boardResolution/8, boardResolution/8, boardResolution/8);
        }



renderStills();
//above draws still pieces

//below draws grabbed piece

if(draggedPiece>=0){
        ctx.drawImage(pieces[boardSquares[draggedPiece]],relativeX-boardResolution/16, relativeY-boardResolution/16, boardResolution/8, boardResolution/8);
    }


    }
}
function mouseOnBoard(e){
    relativeX = e.clientX - canvas.offsetLeft;
     relativeY = e.clientY - canvas.offsetTop;
     if(relativeX<=boardResolution&&relativeX>=0&&relativeY<=boardResolution&&relativeY>=0){
return true;
     }
     return false;
}
var draggedPiece=15;

function mouseDownHandler(e){
mousedownBool=true;

//console.log(e.clientX);
    relativeX = e.clientX - canvas.offsetLeft;
     relativeY = e.clientY - canvas.offsetTop;

     var selectionX = Math.ceil(relativeX/boardResolution*8)-1;
     var selectionY = Math.ceil(relativeY/boardResolution*8)-1;

    var selection = (((selectionY*8)-1)+selectionX)+1;
    if(boardSquares[selection]==0){
        draggedPiece=-1;
    }else{
        draggedPiece = selection;
        updateLegalMoves(selection);
    }
    updateCursorIcon();
    
}

var legalMovesToShow = [0,15,23,47];
function updateLegalMoves(){
legalMovesToShow = [];
for(var i=0;i<=64;i++){
    if(rulebook(draggedPiece,i)){
        legalMovesToShow.push(i);
    }

}
    

}
function mouseUpHandler(e) {
mousedownBool=false;
updateCursorIcon();
relativeX = e.clientX - canvas.offsetLeft;
     relativeY = e.clientY - canvas.offsetTop;

     var selectionX = Math.ceil(relativeX/boardResolution*8)-1;
     var selectionY = Math.ceil(relativeY/boardResolution*8)-1;
     var selection = (((selectionY*8)-1)+selectionX)+1;;
     if(draggedPiece>=0&&rulebook(draggedPiece,selection)){
         var fromValue = boardSquares[draggedPiece];
         boardSquares[draggedPiece]=0;
         boardSquares[selection] = fromValue;
 }
     draggedPiece=-1;
        if(relativeX<=boardResolution){
     drawBackground();
     for(var i=0;i<=64-1;i++){
            var squareX=(i % 8);
            var squareY = Math.floor(i/8);
            if((boardSquares[i]!=0)&& draggedPiece !=i){
                ctx.drawImage(pieces[boardSquares[i]],squareX*boardResolution/8, squareY*boardResolution/8, boardResolution/8, boardResolution/8);
            }}

        }

}

function getPiece(myx,myy){
return boardSquares[(((myy*8))+myx)];
}

function rulebook(source,destination){
    var sourceX=(source % 8);
    var sourceY = Math.floor(source/8);
    var destX=(destination % 8);
    var destY = Math.floor(destination/8);



    if(boardSquares[source]==1&&sourceX==destX){
        if(sourceY==destY+1&&getPiece(destX,destY)==0){
        return true;    //normal forward
            }

            if(sourceY==6 && destY==4 &&getPiece(destX,4)==0&&getPiece(destX,5)==0){
            return true;
            }



    }


    
return false;

}



function drawBackground(){
    var bgSquare = 0;
    
  while(bgSquare<=64){
        var squareX=(bgSquare % 8);
       var squareY = Math.floor(bgSquare/8);

if((squareX+squareY)%2){
    ctx.beginPath();
 ctx.rect(squareX*boardResolution/8, squareY*boardResolution/8, boardResolution/8, boardResolution/8);
                 ctx.fillStyle = "#779AAF";
                 ctx.fill();       
            ctx.closePath();
}else{
    ctx.beginPath();
 ctx.rect(squareX*boardResolution/8, squareY*boardResolution/8, boardResolution/8, boardResolution/8);
                 ctx.fillStyle = "#d5E1E5";
                 ctx.fill();       
            ctx.closePath();
            
}    

bgSquare +=1;
 
}
}
drawBackground();

</script>


</body>
</html>